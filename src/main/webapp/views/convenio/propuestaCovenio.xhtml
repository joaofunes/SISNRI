<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition  template="/WEB-INF/templates/layout.xhtml"
                 xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:f="http://java.sun.com/jsf/core"
                 xmlns:h="http://java.sun.com/jsf/html"
                 xmlns:ui="http://java.sun.com/jsf/facelets"
                 xmlns:p="http://primefaces.org/ui"
                 xmlns:pe="http://primefaces.org/ui/extensions" 
                 xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                 >


    <ui:define name="content">
        <f:metadata>            
            <f:viewAction action="#{propuestaConvenioMB.onload}" />
        </f:metadata>

        <h:form id="formAdmin">
        </h:form>   

        <center>
            <p:panel style="width: 80%">  
                <p:accordionPanel multiple="true" activeIndex="0,1,2,3" id="acordion">
                    <p:tab title="Datos del Solicitante">


                        <h:form id="GroupSolicitante" > 
                            <p:panelGrid >                           
                                <p:row rendered="#{propuestaConvenioMB.rol != null}">
                                    <p:column>
                                    <p:outputLabel for="tipoBusquedaSol" value="Criterio de Busqueda:" />
                                </p:column>
                                <p:column>                                         
                                    <p:selectOneMenu id="tipoBusquedaSol" value="#{propuestaConvenioMB.tipoBusquedaSolicitante}"  style="width:125px">  
                                        <p:ajax  listener="#{propuestaConvenioMB.habilitarAutoSolicitante}" update="acordion:GroupSolicitante"  process="@this" />
                                        <f:selectItem itemLabel="Seleccione" itemValue="#{null}" noSelectionOption="true" />                                                                           
                                        <f:selectItem itemLabel="Nombres" itemValue="nombre" />                                                                           
                                        <f:selectItem itemLabel="E-mail" itemValue="email" />
                                        <f:selectItem itemLabel="Documento" itemValue="doc" />  
                                    </p:selectOneMenu>
                               </p:column>
                                       rendered="#{!propuestaConvenioMB.bloqueosInterno}"                      
                                <p:column > 
                                    <p:autoComplete id="searchDuiSolicitante" minQueryLength="9" size="9" 
                                                    rendered="#{propuestaConvenioMB.flagSearchDuiSolicitante}" 
                                                    value="#{propuestaConvenioMB.solicitante}" completeMethod="#{propuestaConvenioMB.completeBusquedaDui}"
                                                    var="name" itemLabel="#{name.duiPersona}" itemValue="#{name}" converter="#{personaConverter}"
                                                    cache="true" queryDelay="1000"
                                                    emptyMessage="Solicitante no encontrado ......."
                                                    forceSelection="true">                                            
                                        <p:column>
                                            <h:outputText value="#{name.duiPersona}" />
                                        </p:column>
                                    </p:autoComplete>
                                    <p:watermark for="searchDuiSolicitante" value="DUI"/>  
                                    
                                    <p:autoComplete id="idNombreSolicitante" value="#{propuestaConvenioMB.solicitante}" 
                                                    rendered="#{propuestaConvenioMB.flagSearchNombreSolicitante}"
                                                    completeMethod="#{propuestaConvenioMB.methodSearchSolicitante}"                                                     
                                                    var="theme" itemLabel="#{theme.nombrePersona}" itemValue="#{theme}" converter="#{personaConverter}" 
                                                    cache="true" queryDelay="1000"
                                                    emptyMessage="Solicitante no encontrado ......."                                                    
                                                    forceSelection="true">                                           
                                        <p:column>
                                            <h:outputText value="#{theme.nombrePersona}" />
                                        </p:column>
                                        <p:ajax event="itemSelect" listener="#{propuestaConvenioMB.cargarNombreSolicitante()}" process="@this" update="acordion:GroupSolicitante"/>
                                    </p:autoComplete>
                                    <p:watermark for="idNombreSolicitante" value="Nombre"/> 
                                    
                                    <p:autoComplete id="idEmailSolicitante" value="#{propuestaConvenioMB.solicitante}" 
                                                    rendered="#{propuestaConvenioMB.flagSearchEmailSolicitante}"
                                                    completeMethod="#{propuestaConvenioMB.methodSearchSolicitante}"                                                     
                                                    var="theme" itemLabel="#{theme.emailPersona}" itemValue="#{theme}" converter="#{personaConverter}" 
                                                    cache="true" queryDelay="1000"
                                                    emptyMessage="Solicitante no encontrado ......."    
                                                    forceSelection="true">                                           
                                        <p:column>
                                            <h:outputText value="#{theme.emailPersona}" />
                                        </p:column>
                                        <p:ajax event="itemSelect" listener="#{propuestaConvenioMB.cargarNombreSolicitante()}" process="@this" update="acordion:GroupSolicitante"/>
                                    </p:autoComplete>
                                    <p:watermark for="idEmailSolicitante" value="E-mail"/> 
                                </p:column>
                                   
                                </p:row>  
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idSolicinateNombre" value="Nombre Solicitante" />
                                    </p:column>

                                    <p:column  >
                                        <p:inputText id="idSolicinateNombre"  required="true" label="Nombre" value="#{propuestaConvenioMB.solicitante.nombrePersona}" />
                                        <p:message for="idSolicinateNombre" />   
                                        <p:watermark for="idSolicinateNombre" value="Nombre Solicitante" id="watermarkNameSol" />                                           
                                    </p:column>

                                    <p:column>
                                        <p:outputLabel for="idSolicinateApellido" value="Apellido Solicitante" />
                                    </p:column>

                                    <p:column >
                                        <p:inputText id="idSolicinateApellido"  required="true" label="Apellido" value="#{propuestaConvenioMB.solicitante.apellidoPersona}" />
                                        <p:message for="idSolicinateApellido" />   
                                        <p:watermark for="idSolicinateApellido" value="Apellido Solicitante"  />                                           
                                    </p:column>
                                </p:row> 
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idTelFijoSolicitante" value="Tel:" />
                                    </p:column>
                                    <p:column>                                                               
                                        <p:inputMask id="idTelFijoSolicitante" required="true"  mask="9999-9999" value="#{propuestaConvenioMB.telFijoSolicitante.numeroTelefono}" />
                                        <p:watermark for="idTelFijoSolicitante" value="xxxx-xxxx"  /> 
                                        <p:message for="idTelFijoSolicitante" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel for="idCelSolicitante" value="Cel:" />
                                    </p:column>
                                    <p:column>
                                        <p:inputMask id="idCelSolicitante" required="true" mask="9999-9999" value="#{propuestaConvenioMB.telCelularSolicitante.numeroTelefono}" />
                                        <p:watermark for="idCelSolicitante" value="xxxx-xxxx"  /> 
                                        <p:message for="idCelSolicitante" />
                                    </p:column>
                                </p:row>


                                <p:row>

                                    <p:column>
                                        <p:outputLabel  for="idFacultadUnidad" value="Facultad/Unidad"  />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu id="idFacultadUnidad" required="true" value="#{propuestaConvenioMB.facultadesUnidades}" converter="#{facultadUnidadConverter}" style="width:190px">                                   
                                            <p:ajax event="change" process="@this" update="idEscuelaDept" listener="#{propuestaConvenioMB.actualizarEscuelaDept()}"/>
                                            <f:selectItem itemLabel="--Seleccione Facultad/Unidad--" itemValue="#{null}"  itemDisabled="true" />
                                            <f:selectItems value="#{propuestaConvenioMB.listaFacultadUnidad}" var="escDpt" itemLabel="#{escDpt.label}" itemValue="#{escDpt}" />                                                                                       
                                        </p:selectOneMenu>
                                    </p:column>

                                    <p:column>
                                        <p:outputLabel   value="Escuela/Departamento" />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu  id="idEscuelaDept" disabled="#{propuestaConvenioMB.flagEscuelaDept}" required="true" value="#{propuestaConvenioMB.escuelaDepartamento}" converter="#{escuelaDepartamentoConverter}" style="width:160px" >                                              
                                            <f:selectItem itemValue="#{null}" itemLabel="Seleccione Escuela/Departamento" itemDisabled="true" />                                            
                                            <f:selectItems value="#{propuestaConvenioMB.listadoEscuelaDepartamento}" var="escDpt" itemLabel="#{escDpt.nombreEscuelaDepto}" itemValue="#{escDpt}" />                                        
                                        </p:selectOneMenu>
                                    </p:column>

                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idCargo" value="Cargo Solicitante" />
                                    </p:column>
                                    <p:column>
                                        <p:inputText id="idCargo"  required="true" label="cargo" value="#{propuestaConvenioMB.solicitante.cargoPersona}"/>
                                        <p:message for="idCargo" />
                                        <p:watermark for="idCargo" value="Cargo" id="watermarkCargo" />
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <h:outputLabel value="Agregar Solicitante Interno" />
                                    </p:column>
                                    <p:column>
                                        <p:selectBooleanButton id="btnInterno" value="#{propuestaConvenioMB.tabAsisMostrar}" onLabel="Si" offLabel="No" onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:60px">
                                            <p:ajax update="acordion:GroupSolicitanteInterno,acordion:grup1" listener="#{propuestaConvenioMB.mostrarTab()}" />
                                        </p:selectBooleanButton>
                                    </p:column>
                                    <p:column>
                                        <h:outputLabel value="Agregar Solicitante Externo" />
                                    </p:column>
                                    <p:column>
                                        <p:selectBooleanButton id="btnExterno" value="#{propuestaConvenioMB.tabAsisMostrarExterno}" onLabel="Si" offLabel="No" onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:60px">
                                            <p:ajax update="acordion:GroupSolicitanteExterno,acordion:grup2" listener="#{propuestaConvenioMB.mostrarTabExterno()}" />
                                        </p:selectBooleanButton>
                                    </p:column>
                                </p:row>

                            </p:panelGrid>     
                        </h:form>
                    </p:tab>
                    <p:tab title="Datos Solicitante Interno">

                        <h:form id="grup1" > 
                            <p:panelGrid id="grid" rendered="#{propuestaConvenioMB.tabAsis}" >     
                                <p:column>
                                    <p:outputLabel for="tipoBusquedaInt" value="Criterio de Busqueda:" />
                                </p:column>
                                <p:column>                                         
                                    <p:selectOneMenu id="tipoBusquedaInt" value="#{propuestaConvenioMB.tipoBusquedaInterna}"  style="width:125px"
                                        disabled="#{propuestaConvenioMB.bloqueosInterno}">  
                                        <p:ajax  listener="#{propuestaConvenioMB.habilitarAutoInterno}" update="grup1"  process="@this" />
                                        <f:selectItem itemLabel="Seleccione" itemValue="#{null}" noSelectionOption="true" />                                                                           
                                        <f:selectItem itemLabel="Nombres" itemValue="nombre" />                                                                           
                                        <f:selectItem itemLabel="E-mail" itemValue="email" />
                                        <f:selectItem itemLabel="Documento" itemValue="doc" />  
                                    </p:selectOneMenu>
                               </p:column>
                                                             
                                <p:column rendered="#{!propuestaConvenioMB.bloqueosInterno}"> 
                                    <p:autoComplete id="searchDui" minQueryLength="9" size="9" rendered="#{propuestaConvenioMB.flagSearchDuiInterno}" 
                                                    value="#{propuestaConvenioMB.referenteInterno}" completeMethod="#{propuestaConvenioMB.completeBusquedaDui}"
                                                    var="name" itemLabel="#{name.duiPersona}" itemValue="#{name}" converter="#{personaConverter}"
                                                    cache="true" queryDelay="1000"
                                                    emptyMessage="No data ......."
                                                    forceSelection="true">                                            
                                        <p:column>
                                            <h:outputText value="#{name.duiPersona}" />
                                        </p:column>
                                    </p:autoComplete>
                                    <p:watermark for="searchDui" value="DUI"/>  
                                    
                                    <p:autoComplete id="idNombreInterno" value="#{propuestaConvenioMB.referenteInterno}" rendered="#{propuestaConvenioMB.flagSearchNombreInterno}"
                                                    completeMethod="#{propuestaConvenioMB.methodSearch}" 
                                                    disabled="#{propuestaConvenioMB.disableAutoInterno} "
                                                    var="theme" itemLabel="#{theme.nombrePersona}" itemValue="#{theme}" converter="#{personaConverter}" 
                                                    cache="true" queryDelay="1000"
                                                    emptyMessage="Nombre no Encontrado ......."
                                                    forceSelection="true">                                           
                                        <p:column>
                                            <h:outputText value="#{theme.nombrePersona}" />
                                        </p:column>
                                        <p:ajax event="itemSelect" listener="#{propuestaConvenioMB.cargarNombreSoliInterno()}" process="@this" update="acordion:GroupSolicitanteInterno,acordion:grup1"/>
                                    </p:autoComplete>
                                    <p:watermark for="idNombreInterno" value="Nombre"/> 
                                    
                                    <p:autoComplete id="idEmailInterno" value="#{propuestaConvenioMB.referenteInterno}" 
                                                    rendered="#{propuestaConvenioMB.flagSearchEmailInterno}"
                                                    completeMethod="#{propuestaConvenioMB.methodSearch}" 
                                                    disabled="#{propuestaConvenioMB.disableAutoInterno}}"
                                                    var="theme" itemLabel="#{theme.emailPersona}" itemValue="#{theme}" converter="#{personaConverter}" 
                                                    cache="true" queryDelay="1000"
                                                    emptyMessage="Email no Encontrado ......."
                                                    forceSelection="true">                                           
                                        <p:column>
                                            <h:outputText value="#{theme.emailPersona}" />
                                        </p:column>
                                        <p:ajax event="itemSelect" listener="#{propuestaConvenioMB.cargarNombreSoliInterno()}" process="@this" update="acordion:GroupSolicitanteInterno,acordion:grup1"/>
                                    </p:autoComplete>
                                    <p:watermark for="idEmailInterno" value="E-mail"/> 
                                </p:column>
                                <p:column>
                                    <p:column>
                                        <p:commandButton id="btnEditarInterno" rendered="#{propuestaConvenioMB.habilitarBotonEditInterno}"
                                                         actionListener="#{propuestaConvenioMB.preEditeReferenteInterno}" process="@this" update="acordion:GroupSolicitanteInterno,@form" 
                                                         value="Editar"   icon="ui-icon-disk" title="Editar Referente Interno" />                                               
                                    </p:column>
                                    <p:column>                                                                                  
                                        <p:commandButton rendered="#{propuestaConvenioMB.habilitarBotonSaveInterno}"
                                                         actionListener="#{propuestaConvenioMB.preEditeGuardarInterno}" process="@this" update="acordion:GroupSolicitanteInterno,@form" 
                                                         value="Nuevo"  id="btnNuevoInterno" icon="ui-icon-disk" title="Nuevo Referente Interno" />                                               

                                    </p:column>
                                    
                                </p:column>

                            </p:panelGrid >   
                        </h:form> 
                        <h:form id="GroupSolicitanteInterno" >  

                            <p:panelGrid rendered="#{propuestaConvenioMB.tabAsis}">     
                                <p:growl id="msg" />
                                <p:row>                                        
                                    <p:column>
                                        <h:outputLabel value="Mismo Solicitante:" />
                                    </p:column>
                                    <p:column>                                                                                  
                                        <p:selectBooleanButton id="btnMismoInterno" value="#{propuestaConvenioMB.mismoSolicitante}" 
                                                               disabled="#{propuestaConvenioMB.habilitarBotonEditInternoDos}"
                                                               onLabel="Si" offLabel="No" onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:60px">
                                            <p:ajax update="acordion:GroupSolicitanteInterno,acordion:grup1" process="@this" listener="#{propuestaConvenioMB.mismoSolicitantes()}" />
                                        </p:selectBooleanButton>                                    
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idSolicinateNombreInterno" value="Nombre Solicitante" />
                                    </p:column>
                                    <p:column >                                            
                                        <p:inputText id="idSolicinateNombreInterno" required="true"  label="Nombre" 
                                                     value="#{propuestaConvenioMB.referenteInterno.nombrePersona}" 
                                                     disabled="#{propuestaConvenioMB.habilitarBusquedaInterna}"/>                                
                                        <p:watermark for="idSolicinateNombreInterno" value="Nombre Solicitante"/>                                           
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel for="idSolicinateApellidoInterno" value="Apellido Solicitante" />
                                    </p:column>
                                    <p:column>
                                        <p:inputText id="idSolicinateApellidoInterno" required="true"  label="Apellido" 
                                                     value="#{propuestaConvenioMB.referenteInterno.apellidoPersona}" 
                                                     disabled="#{propuestaConvenioMB.habilitarBusquedaInterna}"/>
                                        <p:message for="idSolicinateApellidoInterno" />   
                                        <p:watermark for="idSolicinateApellidoInterno" value="Apellido Solicitante"/>                                           
                                    </p:column>
                                </p:row>                            
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idDui" value="N&deg; DUI" />     
                                    </p:column>
                                    <p:column>
                                        <p:inputMask id="idDui"  value="#{propuestaConvenioMB.referenteInterno.duiPersona}" mask="99999999-9"
                                                     disabled="#{propuestaConvenioMB.habilitarBusquedaInterna}"/>                                           
                                        <p:watermark for="idDui" value="999999999-9" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel for="email" value="Correo Electr&oacute;nico" />     
                                    </p:column>
                                    <p:column>
                                        <p:inputText id="email" required="true" value="#{propuestaConvenioMB.referenteInterno.emailPersona}"
                                                     disabled="#{propuestaConvenioMB.habilitarBusquedaInterna}">
                                            <f:validator validatorId="com.sisrni.validator.emailValidator" />
                                        </p:inputText>
                                        <p:message for="email" display="tooltip" />  
                                        <p:watermark for="email" value="correo@email.com"/>
                                    </p:column>

                                </p:row>   
                                <p:row rendered="#{propuestaConvenioMB.rol != null}">
                                    <p:column>
                                        <p:outputLabel for="idTelFijoInterno" value="Tel:" />
                                    </p:column>
                                    <p:column>                                                               
                                        <p:inputMask id="idTelFijoInterno"  mask="9999-9999" value="#{propuestaConvenioMB.telFijoInterno.numeroTelefono}" 
                                                     disabled="#{propuestaConvenioMB.habilitarBusquedaInterna}"/>
                                        <p:watermark for="idTelFijoInterno" value="xxxx-xxxx"  /> 
                                        <p:message for="idTelFijoInterno" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel for="idCelInterno" value="Cel:" />
                                    </p:column>
                                    <p:column>
                                        <p:inputMask id="idCelInterno"  mask="9999-9999" value="#{propuestaConvenioMB.telCelularInterno.numeroTelefono}" 
                                                     disabled="#{propuestaConvenioMB.habilitarBusquedaInterna}"/>
                                        <p:watermark for="idCelInterno" value="xxxx-xxxx"  /> 
                                        <p:message for="idCelInterno" />
                                    </p:column>
                                </p:row>
                                <p:row rendered="#{propuestaConvenioMB.rol != null}">                           
                                    <p:column>
                                        <p:outputLabel  for="idFacultadUnidadInterno" value="Facultad/Unidad"  />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu  id="idFacultadUnidadInterno" required="true" value="#{propuestaConvenioMB.facultadesUnidadesInterno}" 
                                                          converter="#{facultadUnidadConverter}" style="width:160px" 
                                                          editable="#{propuestaConvenioMB.mismoSol}"  disabled="#{propuestaConvenioMB.habilitarBusquedaInterna}">                                              
                                            <f:selectItem itemValue="#{null}" itemLabel="Seleccione Facultad/Unidad" noSelectionOption="true" />                                            
                                            <f:selectItems  value="#{propuestaConvenioMB.listaFacultadUnidad}" var="pFacUni" itemLabel="#{pFacUni.label}" itemValue="#{pFacUni}" />
                                            <p:ajax event="change" listener="#{propuestaConvenioMB.actualizarEscuelaDeptInterno()}" update="idEscuelaDeptInter" process="@this" partialSubmit="true"/>
                                        </p:selectOneMenu>                                            
                                    </p:column>                        
                                    <p:column>
                                        <p:outputLabel  for="idEscuelaDeptInter" value="Escuela/Departamento" />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu  id="idEscuelaDeptInter" required="true"  value="#{propuestaConvenioMB.escuelaDepartamentoInterno}" 
                                                          converter="#{escuelaDepartamentoConverter}" disabled="#{propuestaConvenioMB.flagEscuelaDeptInterno || propuestaConvenioMB.habilitarBusquedaInterna}"  
                                                          style="width:160px" editable="#{propuestaConvenioMB.mismoSol}">                                              
                                            <f:selectItem itemValue="#{null}" itemLabel="Seleccione Escuela/Departamento" noSelectionOption="true" />                                            
                                            <f:selectItems value="#{propuestaConvenioMB.listadoEscuelaDepartamentoInter}" var="escDpt" itemLabel="#{escDpt.nombreEscuelaDepto}" itemValue="#{escDpt}" />                                        
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>   
                                <p:row rendered="#{propuestaConvenioMB.rol != null}">
                                    <p:column>
                                        <p:outputLabel for="idCargoInterno" value="Cargo Solicitante" />
                                    </p:column>
                                    <p:column>
                                        <p:inputText id="idCargoInterno"   label="cargo"  value="#{propuestaConvenioMB.referenteInterno.cargoPersona}" 
                                                     disabled="#{propuestaConvenioMB.habilitarBusquedaInterna}"/>
                                        <p:watermark for="idCargoInterno" value="Cargo" id="waterCargo" />
                                        <p:message for="idCargoInterno" />
                                    </p:column>

                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:commandButton id="btnEditarInterno2" rendered="#{propuestaConvenioMB.habilitarBotonEditInternoDos}"
                                                         actionListener="#{propuestaConvenioMB.actualizarReferenteInterno()}" process="@form" update="acordion:GroupSolicitanteInterno" 
                                                         value="Actualizar"   icon="ui-icon-disk" title="Actualizar datos Interno" />                                               
                                        <p:commandButton id="btnNuevoInterno2" rendered="#{propuestaConvenioMB.habilitarBotonSaveInternoDos}"
                                                         actionListener="#{propuestaConvenioMB.actualizarReferenteInterno()}" process="@form" update="acordion:GroupSolicitanteInterno" 
                                                         value="Guardar"   icon="ui-icon-disk" title="Guardar datos Interno" />                                                                                                                                                                                                               
                                    
                                    </p:column>
                                    <p:column>
                                        <p:commandButton rendered="#{propuestaConvenioMB.habilitarBotonEditInternoDos || propuestaConvenioMB.habilitarBotonSaveInternoDos}"
                                                         actionListener="#{propuestaConvenioMB.preCancelarInterno}" process="@this" update="acordion:grup1,@form" 
                                                         value="Cancelar"  id="btnCancelarInterno" icon="ui-icon-disk" title="Cancelar" />                                               

                                    </p:column>
                                </p:row>

                            </p:panelGrid>        
                        </h:form>
                    </p:tab>
                    <p:tab title="Datos Solicitante Externo">
                        <h:form id="grup2" >                                
                            <p:panelGrid rendered="#{propuestaConvenioMB.tabAsisExterno}">     
                                <p:column>
                                    <p:outputLabel for="tipoBusquedaExt" value="Tipo de Busqueda:" />
                                </p:column>

                                <p:column>                                        
                                    <p:selectOneMenu id="tipoBusquedaExt" value="#{propuestaConvenioMB.tipoBusquedaExterna}"  style="width:125px">  
                                        <p:ajax  listener="#{propuestaConvenioMB.habilitarAutoExterno}" update="acordion:grup2"  process="@this" />
                                        <f:selectItem itemLabel="Seleccione" itemValue="#{null}" noSelectionOption="true" />                                                                           
                                        <f:selectItem itemLabel="Nombres" itemValue="nombre" />                                                                           
                                        <f:selectItem itemLabel="E-mail" itemValue="email" />
                                        <f:selectItem itemLabel="Documento" itemValue="doc" />  
                                    </p:selectOneMenu>
                                </p:column>
                                
                                <p:column>

                                    <p:autoComplete id="searchDoc" minQueryLength="8" size="8" rendered="#{propuestaConvenioMB.flagSearchDuiExterno}"  
                                                    value="#{propuestaConvenioMB.numDocumentoExterno}" completeMethod="#{propuestaConvenioMB.completeBusquedaPassaporte}"
                                                    var="name" itemLabel="#{name.duiPersona}" itemValue="#{name}" converter="#{personaConverter}"
                                                    forceSelection="true">                                            
                                        <p:column>
                                            <h:outputText value="#{name.duiPersona}" />
                                        </p:column>
                                    </p:autoComplete>
                                    <p:watermark for="searchDoc" value="Documento"/>  
                                    
                                    <p:autoComplete id="idNombreExterno" value="#{propuestaConvenioMB.referenteExterno}" rendered="#{propuestaConvenioMB.flagSearchNombreExterno}"
                                                    completeMethod="#{propuestaConvenioMB.methodSearchExterno}" disabled="#{propuestaConvenioMB.disableAutoExterno}"
                                                    var="theme" itemLabel="#{theme.nombrePersona}" itemValue="#{theme}" converter="#{personaConverter}" 
                                                    cache="true" queryDelay="1000"
                                                    emptyMessage="Nombre no Encontrado ......."
                                                    forceSelection="true">                                           
                                        <p:column>
                                            <h:outputText value="#{theme.nombrePersona}" />
                                        </p:column>
                                        <p:ajax event="itemSelect" listener="#{propuestaConvenioMB.cargarNombreSoliExterno()}" process="@this" update="acordion:GroupSolicitanteExterno,@form"/>
                                    </p:autoComplete>
                                    <p:watermark for="idNombreExterno" value="Nombre"/> 
                                    
                                    <p:autoComplete id="idEmailExterno" value="#{propuestaConvenioMB.referenteExterno}" rendered="#{propuestaConvenioMB.flagSearchEmailExterno}"
                                                    completeMethod="#{propuestaConvenioMB.methodSearchExterno}" disabled="#{propuestaConvenioMB.disableAutoExterno}"
                                                    var="theme" itemLabel="#{theme.emailPersona}" itemValue="#{theme}" converter="#{personaConverter}" 
                                                    cache="true" queryDelay="1000"
                                                    emptyMessage="Email no Encontrado ......."
                                                    forceSelection="true">                                           
                                        <p:column>
                                            <h:outputText value="#{theme.emailPersona}" />
                                        </p:column>
                                        <p:ajax event="itemSelect" listener="#{propuestaConvenioMB.cargarNombreSoliExterno()}" process="@this" update="acordion:GroupSolicitanteExterno,@form"/>
                                    </p:autoComplete>
                                    <p:watermark for="idEmailExterno" value="E-mail"/> 
                                </p:column>
                               
                                    <p:column>
                                        <p:commandButton id="btnEditarExterno" rendered="#{propuestaConvenioMB.habilitarBotonEditExterno}"
                                                         actionListener="#{propuestaConvenioMB.preEditeReferenteExterno()}" process="@this" update="acordion:GroupSolicitanteExterno,@form" 
                                                         value="Editar"   icon="ui-icon-disk" title="Editar Referente Externo" />                                               
                                    </p:column>
                                    <p:column>                                                                                  
                                        <p:commandButton rendered="#{propuestaConvenioMB.habilitarBotonSaveExterno}"
                                                         actionListener="#{propuestaConvenioMB.preEditeGuardarExterno()}" process="@this" update="acordion:GroupSolicitanteExterno,@form" 
                                                         value="Nuevo"  id="btnNuevoInterno" icon="ui-icon-disk" title="Nuevo Referente Externo" />                                               

                                    </p:column>
                                    
                                
                            </p:panelGrid>
                        </h:form>  
                        <h:form id="GroupSolicitanteExterno" >        
                            <p:panelGrid rendered="#{propuestaConvenioMB.tabAsisExterno}">                           

                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idSolicinateNombreExterno" value="Nombre Solicitante" />
                                    </p:column>
                                    <p:column>                                            

                                        <p:inputText id="idSolicinateNombreExterno" required="true" label="Nombre" value="#{propuestaConvenioMB.referenteExterno.nombrePersona}" />
                                        <p:message for="idSolicinateNombreExterno" />   
                                        <p:watermark for="idSolicinateNombreExterno" value="Nombre Solicitante"/>                                           

                                    </p:column>
                                    <p:column>
                                        <p:outputLabel for="idSolicinateApellidoExterno" value="Apellido Solicitante" />
                                    </p:column>
                                    <p:column>

                                        <p:inputText id="idSolicinateApellidoExterno" required="true"  label="Apellido" value="#{propuestaConvenioMB.referenteExterno.apellidoPersona}" />
                                        <p:message for="idSolicinateApellidoExterno" />   
                                        <p:watermark for="idSolicinateApellidoExterno" value="Apellido Solicitante"/>                                           

                                    </p:column>
                                </p:row>   
                                <p:row>

                                    <p:column>
                                        <p:outputLabel for="emailExterno" value="Correo Electr&oacute;nico" />
                                    </p:column>
                                    <p:column>
                                        <p:inputText id="emailExterno" required="true" value="#{propuestaConvenioMB.referenteExterno.emailPersona}">
                                            <f:validator validatorId="com.sisrni.validator.emailValidator" />
                                        </p:inputText>
                                        <p:message for="emailExterno" display="tooltip" />  
                                        <p:watermark for="emailExterno" value="correo@email.com" id="waterCorreo" />
                                    </p:column> 
                                    <p:column>
                                        <p:outputLabel for="idDocumentoExterno" value="N&deg; Pasaporte/ID" />
                                    </p:column>
                                    <p:column>                                           
                                        <p:inputText id="idDocumentoExterno"  label="Pass/ID" value="#{propuestaConvenioMB.referenteExterno.pasaporte}" />                                    
                                        <p:watermark for="idDocumentoExterno" value="N&deg; Pasaporte/ID" />
                                    </p:column>
                                </p:row>
                                <p:row rendered="#{propuestaConvenioMB.rol != null}">
                                    <p:column>
                                        <p:outputLabel for="idTelefonoExterno" value="Tel: " />
                                    </p:column>
                                    <p:column>
                                        <p:inputMask id="idTelefonoExterno"  mask="9999-9999" value="#{propuestaConvenioMB.telFijoExterno.numeroTelefono}" />
                                        <p:watermark for="idTelefonoExterno" value="xxxx-xxxx" id="waterTelEx" /> 
                                        <p:message for="idTelefonoExterno" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel for="idCelExterno" value="Cel" />
                                    </p:column>
                                    <p:column>
                                        <p:inputMask id="idCelExterno"  mask="9999-9999" value="#{propuestaConvenioMB.telCelularExterno.numeroTelefono}" />
                                        <p:watermark for="idCelExterno" value="xxxx-xxxx" id="waterfaxEx" /> 
                                        <p:message for="idCelExterno" />
                                    </p:column>
                                </p:row>
                                <p:row rendered="#{propuestaConvenioMB.rol != null}">
                                    <p:column>
                                        <p:outputLabel for="idCargoExterno" value="Cargo" />
                                    </p:column>
                                    <p:column>
                                        <p:inputText id="idCargoExterno"   label="cargo" value="#{propuestaConvenioMB.referenteExterno.cargoPersona}"/>
                                        <p:watermark for="idCargoExterno" value="Cargo" id="waterCargoEx" />
                                        <p:message for="idCargoExterno" />
                                    </p:column>

                                    <p:column>
                                        <p:outputLabel for="idEntidadInstitucion" value="Entidad o Instituci&oacute;n"  />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu  id="idEntidadInstitucion" required="true" value="#{propuestaConvenioMB.referenteExterno.idOrganismo}" converter="#{organismoConverter}" style="width:160px" >                                              
                                            <f:selectItem itemValue="#{null}" itemLabel="Seleccione Facultad/Unidad" noSelectionOption="true" />                                            
                                            <f:selectItems value="#{propuestaConvenioMB.listadoOrganismo}" var="organi" itemLabel="#{organi.nombreOrganismo}" itemValue="#{organi}" />
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                 <p:row>
                                    <p:column>
                                        <p:commandButton id="btnEditarExterno2" rendered="#{propuestaConvenioMB.habilitarBotonEditExternoDos}"
                                                         actionListener="#{propuestaConvenioMB.actualizarReferenteE()}" process="@form" update="acordion:GroupSolicitanteExterno" 
                                                         value="Actualizar"   icon="ui-icon-disk" title="Actualizar datos Externos" />                                               
                                        <p:commandButton id="btnNuevoExterno2" rendered="#{propuestaConvenioMB.habilitarBotonSaveExternoDos}"
                                                         actionListener="#{propuestaConvenioMB.actualizarRe()}" process="@form" update="acordion:GroupSolicitanteExterno" 
                                                         value="Guardar"   icon="ui-icon-disk" title="Guardar datos Externos" />                                                                                                                                                                                                               
                                    
                                    </p:column>
                                    <p:column>
                                        <p:commandButton rendered="#{propuestaConvenioMB.habilitarBotonEditExternoDos || propuestaConvenioMB.habilitarBotonSaveExternoDos}"
                                                         actionListener="#{propuestaConvenioMB.preCancelarExterno}" process="@this" update="acordion:grup2,@form" 
                                                         value="Cancelar"  id="btnCancelarExterno" icon="ui-icon-disk" title="Cancelar" />                                               

                                    </p:column>
                                </p:row>

                            </p:panelGrid>   
                        </h:form>
                    </p:tab>
                    <p:tab title="Datos de Propuesta">
                        <h:panelGroup id="fileUploadGroup" >    
                            <p:panelGrid>                           
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idTipoPropuesta" value="Tipo de Propuesta" />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu id="idTipoPropuesta" required="true"  value="#{propuestaConvenioMB.propuestaConvenio.idTipoPropuestaConvenio}" converter="#{tipoPropuestaConvenioConverter}" effect="fade"  style="width:160px" >                                            
                                            <p:ajax  listener="#{propuestaConvenioMB.onTipoConvenioChange}" update="idConvenioPropuesta"  process="@this" />
                                            <f:selectItem itemValue="#{null}" itemLabel="Seleccione Tipo Propuesta" noSelectionOption="true" />                                            
                                            <f:selectItems value="#{propuestaConvenioMB.listadoTipoPrpouestaConvenio}" var="tipoPropCon" itemLabel="#{tipoPropCon.nombrePropuestaConvenio}" itemValue="#{tipoPropCon}" />       
                                        </p:selectOneMenu>
                                        <p:message for="idTipoPropuesta" />  
                                    </p:column>
                                </p:row>
                                <p:row>

                                    <p:column>
                                        <p:outputLabel  value="Convenio"  />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu disabled="#{propuestaConvenioMB.flagConvenioMarco}" id="idConvenioPropuesta" required="true" value="#{propuestaConvenioMB.propuestaConvenioTemp}" converter="#{propuestaConvenioConverter}"  style="width:160px" >                                              
                                            <f:selectItem itemValue="#{null}" itemLabel="Seleccione Convenio" noSelectionOption="true" />                                            
                                            <f:selectItems value="#{propuestaConvenioMB.listadoPropuestaConvenio}" var="pConve" itemLabel="#{pConve.nombrePropuesta}" itemValue="#{pConve}" />
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idNombrePropuesta" value="Nombre de Propuesta" />
                                    </p:column>
                                    <p:column>
                                        <p:inputText id="idNombrePropuesta"  required="true" label="nombre propuesta" value="#{propuestaConvenioMB.propuestaConvenio.nombrePropuesta}"/>
                                        <p:message for="idNombrePropuesta" />
                                        <p:watermark for="idNombrePropuesta" value="Nombre Propuesta" id="nameProp" />
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel for="idDescripcionPropuesta" value="Descripci&oacute;n" />
                                    </p:column>
                                    <p:column>
                                        <p:inputTextarea id="idDescripcionPropuesta" required="true" label="descripcion" maxlength="300" value="#{propuestaConvenioMB.propuestaConvenio.finalidadPropuesta}" rows="6" style="width: 300px;" />
                                        <p:message for="idDescripcionPropuesta" /> 
                                        <p:watermark for="idDescripcionPropuesta" value="Descripcion" id="descripcionProp" />
                                    </p:column>
                                </p:row>
                                <table style="width:80%" > 
                                    <tfoot>                                        
                                        <tr align="right"> 
                                            <td></td>
                                            <td></td>
                                            <td colspan="3"><p:commandButton rendered="#{!propuestaConvenioMB.flagEdicion}" actionListener="#{propuestaConvenioMB.guardarPropuestaConvenio}" process="formAdmin" update="formAdmin" value="Guardar"  id="btnGuardar" icon="ui-icon-disk" title="Guardar Propuesta Convenio" /></td>                                 
                                            <!--<td colspan="3"><p:commandButton rendered="#{!propuestaConvenioMB.flagEdicion}" actionListener="#{propuestaConvenioMB.FileRead()}" process="@this"  value="Test Mail"  id="ema" icon="ui-icon-disk" title="envio email" /></td>-->                                 
                                            <td colspan="3"><p:commandButton rendered="#{propuestaConvenioMB.flagEdicion}" actionListener="#{propuestaConvenioMB.actualizarPropuestaConvenio}" process="formAdmin" update="formAdmin" value="Actualizar"  id="btnActualizar" icon="fa fa-save" title="Actualizar Propuesta Convenio" /></td>                                 
                                            <td colspan="3"><p:commandButton  rendered="#{propuestaConvenioMB.flagEdicion}"  actionListener="#{propuestaConvenioMB.volver()}" process="formAdmin" update="formAdmin" value="Volver"  id="btnAtras" icon="ui-icon-disk" title="Volver Consulta Convenio" /></td>                                 
                                        </tr>
                                    </tfoot>
                                </table>  
                            </p:panelGrid> 
                        </h:panelGroup>
                    </p:tab>
                </p:accordionPanel>                                                                                               
            </p:panel>

        </center>    

        <script type="text/javascript">

            PrimeFaces.validator['custom.emailValidator'] = {
                pattern: /\S+@\S+/,
                validate: function (element, value) {
                    if (!this.pattern.test(value)) {
                        throw {
                            summary: 'Validation Error',
                            detail: value + ' is not a valid email.'
                        }
                    }
                }
            };

        </script>

    </ui:define>


</ui:composition>
